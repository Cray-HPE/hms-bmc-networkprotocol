# NETWORK PROTOCOL PARAMETER PACKAGE

## Introduction

This package provides convenience functions for configuring and setting
"network protocol" parameters on Redfish BMCs.

Network Protocol parameters are defined as:

* NTP servers
* Syslog servers
* SSH keys
* SSH console keys
* Node boot order

Note that not all BMCs will support all of these parameters.  Mountain BMCs
support all of them, while for River BMCs it will depend on the vendor.

This package provides functions for setting up a data record containing 
all pertinent network protocol parameters, and also to set them on target
BMCs.

## Package Usage

### Parameter Setup

Pertinent data structure:

```
type NWPData struct {
	CAChainURI    string   //pathname or hms_certs.VaultCAChainURI
	NTPSpec       string   //ip_or_hostname:port
	SyslogSpec    string   //ip_or_hostname:port
	SSHKey        string   //RSA public SSH key
	SSHConsoleKey string   //RSA public key for console access
	BootOrder     []string //Node boot method order
}
```


To use this package, the Init() or InitInstance() function is called after
creating a data object containing the pertinent network protocol information.

```
func Init(nwpData NWPData, rfSuffix string) (RedfishNWProtocol,error)

func InitInstance(nwpData NWPData, rfSuffix string, svcName string) (RedfishNWProtocol,error)

```

Note that the InitInstance() function does the same thing as the Init() function except that it takes an extra parameter which is the microservice instance name.  This is used when performing HTTP calls; it sets a header making it possible for the receiver to know who sent the HTTP request.  Its use is optional but encouragled for improved system debuggability.

The *nwpData* data object will contain the following information:

* **CAChainURI** -- this is generally obtained from the environment.  It is the URI of the Vault CA authority, e.g. *vault://pki_common/ca_chain*.  This can be an empty string, meaning all HTTP communications will not be TLS-certified.
* **NTPSpec** -- This specifies the NTP server in a name:port format.  The name can be an IP address or a hostname.  This is typically obtained from the environment.
* **SyslogSpec** -- This specifies the syslog server in a name:port format.  The name can be an IP address or a hostname.  This is typically obtained from the environment.
* **SSHKey** -- This is the public RSA SSH key of the administrative account on the target BMCs.  Typically only valid on Mountain BMCs.  This key is generated by the admin.
* **SSHConsoleKey** -- Similar to the SSH key but only used for console access.  Typically only valid on Mountain BMCs.  This key is generated by the admin.
* **BootOrder** -- Specifies the boot order for nodes controlled by the BMC.  This is specified as a slice of strings, each one containing a boot method; each boot method is vendor-specific.

The *rfSuffix* parameter is a string containing the Redfish path suffix to the
network protocol parameter area, e.g.: 

```
/redfish/v1/Managers/BMC/NetworkProtocol
```

This path will be vendor-dependent.

The data returned from this function is a populated RedfishNWProtocol object, suitable for marshalling and sending to a Redfish BMC.

## Setting Network Protocol Parameters On Redfish BMCs

This is accomplished by calling the SetXNameNWPInfo() function after calling Init() or InitInstance().

```
func SetXNameNWPInfo(nwProtoInfo RedfishNWProtocol, targAddress, RFUsername, RFPassword string) error
```

Parameters:

* **nwProtoInfo** -- This is the object returned from Init() or InitInstance(), and can be used unmodified.  It contains the network protocol parameters to set on the target BMC.
* **targAddress** -- This is the hostname or IP address of the target BMC, e.g., *x1000c0s0b0*.
* **RFUsername, RFPassword** -- These are the Redfish access credentials for the BMC.

This function returns an error if anything goes wrong along the way.

## Copy Function For Network Protocol Data

This package provides a convenience function doing a deep copy of a network protocol data object returned by the Init() and InitInstance() functions.

```
func CopyRFNetworkProtocol(src *RedfishNWProtocol) RedfishNWProtocol
```





